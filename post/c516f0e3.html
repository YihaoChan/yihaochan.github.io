<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="0 前言第一次参赛，意义特殊，记录一下。 比赛链接：https:&#x2F;&#x2F;tianchi.aliyun.com&#x2F;competition&#x2F;entrance&#x2F;531852&#x2F;introduction?lang&#x3D;zh-cn 完整代码：https:&#x2F;&#x2F;github.com&#x2F;YihaoChan&#x2F;2021-Tianchi-GAIIC-Track1-Rank-3">
<meta property="og:type" content="article">
<meta property="og:title" content="2021-天池-GAIIC-赛道一-记录">
<meta property="og:url" content="http://example.com/post/c516f0e3.html">
<meta property="og:site_name" content="Yihao Chan&#39;s Blog">
<meta property="og:description" content="0 前言第一次参赛，意义特殊，记录一下。 比赛链接：https:&#x2F;&#x2F;tianchi.aliyun.com&#x2F;competition&#x2F;entrance&#x2F;531852&#x2F;introduction?lang&#x3D;zh-cn 完整代码：https:&#x2F;&#x2F;github.com&#x2F;YihaoChan&#x2F;2021-Tianchi-GAIIC-Track1-Rank-3">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/%E8%AF%81%E4%B9%A6.jpg">
<meta property="og:image" content="http://example.com/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/%E5%A5%96%E6%9D%AF.jpg">
<meta property="og:image" content="http://example.com/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/distribution_train.jpg">
<meta property="og:image" content="http://example.com/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/distribution_test_a.jpg">
<meta property="og:image" content="http://example.com/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/seq_len_train_set.jpg">
<meta property="og:image" content="http://example.com/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/seq_len_test_set_a.jpg">
<meta property="og:image" content="http://example.com/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/3D_results_lstm.jpg">
<meta property="og:image" content="http://example.com/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/3D_results_han.jpg">
<meta property="og:image" content="http://example.com/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/3D_results_dpcnn.jpg">
<meta property="og:image" content="http://example.com/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/3D_results_nezha.jpg">
<meta property="og:image" content="http://example.com/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/3D_results_merge.jpg">
<meta property="article:published_time" content="2021-06-05T14:12:16.000Z">
<meta property="article:modified_time" content="2021-06-05T14:17:35.055Z">
<meta property="article:author" content="Yihao Chan">
<meta property="article:tag" content="Competition">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/%E8%AF%81%E4%B9%A6.jpg">

<link rel="canonical" href="http://example.com/post/c516f0e3.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>2021-天池-GAIIC-赛道一-记录 | Yihao Chan's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Yihao Chan's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Something about Chen Yihao.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/post/c516f0e3.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/assets/avatar.jpg">
      <meta itemprop="name" content="Yihao Chan">
      <meta itemprop="description" content="God helps those who help themselves.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yihao Chan's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2021-天池-GAIIC-赛道一-记录
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-06-05 22:12:16 / Modified: 22:17:35" itemprop="dateCreated datePublished" datetime="2021-06-05T22:12:16+08:00">2021-06-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NLP/" itemprop="url" rel="index"><span itemprop="name">NLP</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>6.1k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>6 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="0-前言"><a href="#0-前言" class="headerlink" title="0 前言"></a>0 前言</h1><p>第一次参赛，意义特殊，记录一下。</p>
<p>比赛链接：<a target="_blank" rel="noopener" href="https://tianchi.aliyun.com/competition/entrance/531852/introduction?lang=zh-cn">https://tianchi.aliyun.com/competition/entrance/531852/introduction?lang=zh-cn</a></p>
<p>完整代码：<a target="_blank" rel="noopener" href="https://github.com/YihaoChan/2021-Tianchi-GAIIC-Track1-Rank-3">https://github.com/YihaoChan/2021-Tianchi-GAIIC-Track1-Rank-3</a></p>
<a id="more"></a>

<p><img data-src="/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/%E8%AF%81%E4%B9%A6.jpg"></p>
<p><img data-src="/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/%E5%A5%96%E6%9D%AF.jpg"></p>
<h1 id="1-赛题介绍"><a href="#1-赛题介绍" class="headerlink" title="1 赛题介绍"></a>1 赛题介绍</h1><ul>
<li><p>提供：CT影像描述文本；</p>
</li>
<li><p>样例：右下肺野见小结节样影与软组织肿块影 =&gt; 患病区域：右下肺野，诊断类型：小结节样影与软组织肿块影；</p>
</li>
<li><p>需求：判断身体若干目标区域是否有异常以及异常类型.</p>
</li>
</ul>
<p>从”若干”可判断出任务属于<strong>多标签</strong>任务，从”区域是否有异常”及”异常类型”可以考虑将不同区域和不同类型做<strong>onehot编码</strong>，之后进行<strong>0/1的二分类</strong>。简而言之，赛题属于多标签二分类问题。</p>
<h1 id="2-数据样例"><a href="#2-数据样例" class="headerlink" title="2 数据样例"></a>2 数据样例</h1><table>
<thead>
<tr>
<th align="center">列名</th>
<th align="center">类型</th>
<th align="center">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">report_ID</td>
<td align="center">int</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">description</td>
<td align="center">文本，<strong>脱敏</strong></td>
<td align="center">101 47 12 66 74 90 0 411 234 79</td>
</tr>
<tr>
<td align="center">label</td>
<td align="center">区域<strong>ID</strong>，类型<strong>ID</strong></td>
<td align="center">3 4, 0 2</td>
</tr>
</tbody></table>
<p>数据没有任何明文，都是对中文进行加密后的数字，属于无明文<strong>脱敏</strong>数据。由此判断，无法直接调用任何已经开源的预训练权重做下游任务，如果要采用预训练模型的话，需要从头训练(Train from scratch)。</p>
<h1 id="3-数据探索与分析"><a href="#3-数据探索与分析" class="headerlink" title="3 数据探索与分析"></a>3 数据探索与分析</h1><h2 id="3-1-data分布"><a href="#3-1-data分布" class="headerlink" title="3.1 data分布"></a>3.1 data分布</h2><p>对训练集和A榜测试集的description字段数据进行PCA降至二维并可视化分布图后，如图：</p>
<p><img data-src="/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/distribution_train.jpg"></p>
<p><img data-src="/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/distribution_test_a.jpg"></p>
<p>训练集和A榜测试集的data满足同分布。</p>
<h2 id="3-2-句长分布"><a href="#3-2-句长分布" class="headerlink" title="3.2 句长分布"></a>3.2 句长分布</h2><p>统计训练集和A榜测试集中不同句长所对应的description数量，如图：</p>
<p><img data-src="/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/seq_len_train_set.jpg"></p>
<p><img data-src="/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/seq_len_test_set_a.jpg"></p>
<p>训练集和A榜测试集上，最短句长均为4，最长句长分别为104和102，做句长截断、填充的时候可以参考。</p>
<h2 id="3-3-词频统计"><a href="#3-3-词频统计" class="headerlink" title="3.3 词频统计"></a>3.3 词频统计</h2><p>对训练集和A榜测试集的description字段数据进行词频统计：</p>
<p>训练集和A榜测试集上，编码均从0 ~ 857，词典大小均为858。词频的top2所对应的词相同，均为693、328，结合以往阅读文章的经验，可猜想这两个数字对应中文明文的逗号和句号。这也是后续我们的方案中，<strong>去除停用词</strong>的依据。</p>
<h1 id="4-模型"><a href="#4-模型" class="headerlink" title="4 模型"></a>4 模型</h1><h2 id="4-1-初赛"><a href="#4-1-初赛" class="headerlink" title="4.1 初赛"></a>4.1 初赛</h2><p>初赛我们最后融合的模型有：NEZHA、LSTM、HAN、DPCNN。</p>
<p>灵机一动，参考NEZHA名字的由来：</p>
<p><strong>NEZHA: <em>NE</em>ural contextuali<em>Z</em>ed representation for C<em>H</em>inese l<em>A</em>nguage understanding</strong></p>
<p>我也想了一个单词，组合我们所用的这些模型：</p>
<p><strong>Normandy: <em>N</em>EZHA, L<em>O</em>ng Sho<em>R</em>t-Term <em>M</em>emory, Hierarchical <em>A</em>ttention <em>N</em>etworks and <em>D</em>eep P<em>Y</em>ramid Convolutional Neural Networks</strong></p>
<p>主要流程：</p>
<ol>
<li>对于基础深度学习模型(LSTM、HAN、DPCNN)：先去除停用词(693、328)，然后使用WarmUp + 余弦退火进行学习率调整；</li>
<li>对于NEZHA预训练模型：将训练集和测试集的description进行”一句一文档”的操作进行预训练，之所以进行”一句一文档”，是为了取消BERT模型的NSP(Next Sentence Prediction)任务，因为NSP任务在BERT类模型上表现都不好，这一点已在RoBERTa论文中有提到。单进行MLM任务之后，接MLP进入微调训练阶段，结合FGM对抗训练和WarmUp + 余弦退火调整学习率；</li>
<li>两类模型均使用分层采样与k折交叉验证；</li>
<li>最后将两部分结果进行加权融合，单模得分较高者获得更大的权重。</li>
</ol>
<p>单模结果与融合后结果3D可视化：</p>
<p><img data-src="/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/3D_results_lstm.jpg"></p>
<p><img data-src="/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/3D_results_han.jpg"></p>
<p><img data-src="/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/3D_results_dpcnn.jpg"></p>
<p><img data-src="/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/3D_results_nezha.jpg"></p>
<p><img data-src="/images/2021-%E5%A4%A9%E6%B1%A0-GAIIC-%E8%B5%9B%E9%81%93%E4%B8%80-%E8%AE%B0%E5%BD%95/3D_results_merge.jpg"></p>
<h2 id="4-2-复赛模型"><a href="#4-2-复赛模型" class="headerlink" title="4.2 复赛模型"></a>4.2 复赛模型</h2><p>同初赛，复赛我们所采用的模型的名字为：</p>
<p><strong>Noah’s Ark: <em>N</em>EZHA Trained J<em>O</em>intly and Sep<em>A</em>rately with <em>H</em>AN, L<em>S</em>TM and Deep Pyr<em>A</em>mid Convolutional Neu<em>R</em>al Networ<em>K</em>s</strong></p>
<p>主要流程：</p>
<ol>
<li>对于基础深度学习模型(LSTM、HAN、DPCNN)：采用分开训练的策略，即，将任务1和任务2分别训练，之后再将结果进行拼接。训练过程中，先去除停用词(693、328)，然后使用WarmUp + 余弦退火进行学习率调整；</li>
<li>对于NEZHA预训练模型：采用联合训练与分开训练两种策略，即，(1)将两个任务拼接作为一个完整任务进行训练，(2)将任务1和任务2分别训练，之后再将结果进行拼接。因为NEZHA单模表现实在太优秀，所以两种策略都做，之后再融合。训练过程中，结合FGM对抗训练和WarmUp + 余弦退火调整学习率；</li>
<li>两类模型均使用分层采样与k折交叉验证；</li>
<li>最后将两部分结果进行加权融合，单模得分较高者获得更大的权重。</li>
</ol>
<p>复赛的测试集和提交结果等均在线上不可下载、不可打印，所以无可视化图。</p>
<h1 id="5-失败的尝试"><a href="#5-失败的尝试" class="headerlink" title="5 失败的尝试"></a>5 失败的尝试</h1><ol>
<li>伪标签：第一次先用原训练集进行训练后，对测试集做推理，得出初步推理结果。之后将推理得到的output和测试集的data拼接成新的训练数据加入训练集，再对这个新的训练集进行训练，最后对测试集再做一次推理，得到提交结果；</li>
<li>数据增强：随机替换、随机删除、分段乱序。掉分原因可能是因为简单数据增强(EDA,  Easy Data Augmentation)，增强获得的数据质量不够高，增强的数据分布可能破坏了原数据集的分布；</li>
<li>对损失函数手动分配权重：由于标签类别不平衡，最多的类别所对应数据数量有1846，最少的只有209，属于类别不平衡问题。因此考虑在训练的时候给损失函数直接设定一定的比例，使得算法能够对小类数据具有更多的”注意力”；</li>
<li>拼接Word2Vec和GloVe词向量做Embedding层的初始化：对于基础深度学习模型，先用Word2Vec和GloVe分别做词向量预训练，然后将这两部分词向量进行拼接，初始化Embedding层，不冻结权重，在训练过程中继续学习；</li>
<li>分组构造NSP任务：对于标签相同的description，将它们拼接成同一个文档，构造出一个文档中有多个句子的状况，以加入预训练过程中的NSP任务。</li>
</ol>
<h1 id="6-方案不足"><a href="#6-方案不足" class="headerlink" title="6 方案不足"></a>6 方案不足</h1><ol>
<li>训练时间较长：V100单卡，全流程需要40小时左右；</li>
<li>推理速度较慢：V100单卡，推理速度320ms/条。</li>
</ol>
<h1 id="7-与自己有关的事情"><a href="#7-与自己有关的事情" class="headerlink" title="7 与自己有关的事情"></a>7 与自己有关的事情</h1><h2 id="7-1-参赛前"><a href="#7-1-参赛前" class="headerlink" title="7.1 参赛前"></a>7.1 参赛前</h2><p>二月末的时候，同班同学zyp发给了我有关这个比赛的链接，还是我们学校计算机学院公众号推送的。当时只看题目的时候，还觉得赛道一可能是数据挖掘类的题(做特征工程的那种)，赛道二明显是CV(不喜欢CV，直接跳过这个题)，赛道三是文本语义匹配，妥妥的NLP，而且肯定BERT当道的类型，当时还完全不了解BERT，只知道个名字…那个时候其实也没什么忙的事情做，而且以后也想往机器学习方面发展，总是要尝试第一次的嘛，看上去赛道一比较适合新手一点，所以就拉上之前做课程项目的固定队友lrx同学，一起决定报名赛道一了。</p>
<h2 id="7-2-初赛"><a href="#7-2-初赛" class="headerlink" title="7.2 初赛"></a>7.2 初赛</h2><h3 id="7-2-1-尝试"><a href="#7-2-1-尝试" class="headerlink" title="7.2.1 尝试"></a>7.2.1 尝试</h3><p>一开始一公布数据集和题目的时候，就开始自己动手实现了，仔细理解了一下题目，发现就是NLP的题。好在之前接触过一点NLP方面的东西，就对照着之前自己做的一些小demo，修修补补，抄抄删删，勉强做出来的baseline真是速度又慢、效果又差…一直很郁闷的时候，群里一位西交自动化的研究生师兄公布了他的baseline。当时跑通baseline之后，明显比我的成绩好得不要太多，就决定拿他的baseline来改了。其实后来才知道，一些热门的比赛中，会有一些选手公布自己的baseline给其他选手，算是一种分享。不过自己也不能太依赖别人的东西，是吧~</p>
<p>看懂baseline，然后封装、优化，形成自己的代码风格后，就开始改模型、调参了。期间多亏了zyp同学在他们实验室的服务器上(偷偷)给我开了个账号，让我连进去炼丹。具体过程见这篇博客：<a target="_blank" rel="noopener" href="https://yihaochan.github.io/post/cb736208.html">记一次内网穿透</a>。把baseline的CNN换上自己中意的双向LSTM之后，一度冲上30名，然后就瓶颈了…好在天池设立了一个”周周星”环节——鼓励每周的排行榜前两名分享自己的方案和心得给其他选手。不得不说这个环节真是太好了，从各位周周星那里真的学到超多比赛的方法和技巧，运用上他们所说的一部分技巧后，我的成绩又有了很大的进步。</p>
<h3 id="7-2-2-结识新队友"><a href="#7-2-2-结识新队友" class="headerlink" title="7.2.2 结识新队友"></a>7.2.2 结识新队友</h3><p>其实蛮可惜的，当时zyp同学和lrx同学都有各自的事情要忙，一位忙实验室的论文、忙着做各种实验抽不出时间，一位因为疫情原因不得不放弃出国、转投简历找工作…所以几乎相当于我一个人在做比赛，实在蛮累的。记得当时我线上成绩在60名左右就上不去了，刚好群里一位选手的队伍线上40名，二缺一，就缺个调BERT的，而我正好想靠BERT继续冲分(因为传统深度学习模型在NLP的比赛实在太难冲前排了…)，所以就征求了一下两位同学的意见，想过去其他的队伍，毕竟靠自己一个人真的太难太累了，而不想把成绩就此止步。两位队友表示理解之后，我就向招队友的队伍毛遂自荐了一下，最后就进入了新队伍啦。</p>
<h3 id="7-2-3-后期"><a href="#7-2-3-后期" class="headerlink" title="7.2.3 后期"></a>7.2.3 后期</h3><p>新队伍的队友是一位学姐和一位师兄。师兄发给了我BERT的keras版本baseline之后，先花了一天了解了下BERT的原理，然后花了一下午看懂代码后优化，变成自己的风格。之后跑了个裸模型提交了一下，比我之前做的基础深度学习模型加一堆tricks和融合之后的效果好太多太多了…用的是BERT的变种——华为的NEZHA。不得不说，BERT人人都用是有道理的。切B榜之后，把NEZHA和学姐那边基础深度学习模型的结果融了一下，18名，进入复赛。</p>
<h2 id="7-3-复赛"><a href="#7-3-复赛" class="headerlink" title="7.3 复赛"></a>7.3 复赛</h2><h3 id="7-3-1-A榜"><a href="#7-3-1-A榜" class="headerlink" title="7.3.1 A榜"></a>7.3.1 A榜</h3><p>进入复赛后，天池要求提供打包好了的Docker镜像，用线上云平台的机器运行。这一点对我们队来说还是很友好的。我就不说了，本科没机器，硕士还没找老师干活(还在自己补基础和做比赛嘿嘿)；学姐是力学相关专业的，机器学习只是她个人兴趣，所以也没有计算资源；有机器的就师兄那边了，但是有时候一天可能要做好多实验，我这边好几个、师兄那边好几个，只用他的机器实在很麻烦。所以就学了一下Docker，试了下能不能跑通提交后，我们队就都采用线上提交的方式了，刚好测试集在线上不可下载，把代码提交到云端，还能挂载线上的测试集，把文本加进语料库做NEZHA的预训练。挺好的，还多学了Docker这项技能。不得不说一句，天池提供的镜像还蛮难用的，兼容性不是很好…</p>
<p>复赛的label在初赛的基础上增加多了一个任务，我就用NEZHA实现了一下，把两个任务拼接成一个总任务、做onehot编码，其余环节不变。当时提交的队伍还蛮少的，我们直接到了前10了，还挺惊喜的。</p>
<p>Well begun is half done. 看到当时的成绩，信心十足。之后进行了蛮多的尝试的：</p>
<ol>
<li>训练策略：这个是最重要的尝试：把两个任务用两个模型分别训练，最后再把推理结果拼接。刚好初赛和复赛的任务1完全一致，所以对于任务1，可以把初赛的训练集也加进来，数据量一下又增加了。一开始还蛮郁闷的，线上一直报OOM(Out of Memory)，明明在脚本入口都释放显存了呀！后来问了下另一个队伍的老哥，建议我两个模型写成两个独立的脚本，真有用，一下就搞定了，名次又往前冲到前5了好像；</li>
<li>固定好NEZHA的折数fold和轮数epoch后，开始加tricks。对抗训练、Warmup + 余弦退火调整学习率、伪标签…把NEZHA单模调到了稳定前10，当时前10好多队伍都是用了模型融合才达到的成绩，我们单模就进了前10，所以单模的效果是真的非常好；</li>
<li>然后把NEZHA分开训练和联合训练两个不同策略训练出来的模型的推理结果做加权平均后，又冲上去了好几名；</li>
<li>临近复赛快结束的时候，学姐那边几个基础深度学习模型也调得差不多了，和NEZHA一融，离进决赛的资格(前6)非常非常接近。</li>
</ol>
<h3 id="7-3-2-B榜"><a href="#7-3-2-B榜" class="headerlink" title="7.3.2 B榜"></a>7.3.2 B榜</h3><p>把多个单模的运行时间分别算了一下，得出我们最后一把梭的方案全流程运行大概要42小时。而做代码管理的是我，切B榜之后提交成绩的也是我。B榜有4天的提交时间，而1天只能提交1次，相比较于其他有机器的队伍可以保存权重提交推理部分来说，他们最多可以提交4次，而我们只能提交2次，如果中间报错了，很有可能出不来成绩…提交的那天早上我心理压力实在太大了，查了很多遍路径、参数，确保万无一失才提交的镜像。提交镜像之后，实在强迫症，反反复复进入镜像又查了五六遍代码，即使查了也没用，交都交了，但是还是真的很不放心…</p>
<p>当然，结局是好的。第一次提交就是我们的最好成绩了，在其他稳进决赛的队伍都提交了成绩之后，我们直接冲到第三。第二次提交就放飞自我了，用了更激进的参数，不过过拟合了哈哈。没事，锁定第三啦！</p>
<h2 id="7-4-决赛"><a href="#7-4-决赛" class="headerlink" title="7.4 决赛"></a>7.4 决赛</h2><p>被通知进入了决赛之后，赶紧开始做PPT。师兄比较有比赛经验，参考往届其他比赛的开源PPT，立马就做出一个框架出来了，之后我在框架上就添加更多细节、更多美化。其实好像初赛的时候哈哈，师兄提供baseline，我做优化。</p>
<p>美化好之后，PPT就发给学姐了，她是主讲人嘛，要根据她的节奏做调整。可以说，我和师兄对PPT做预训练(pretrain)，然后学姐做微调(finetune)，结合BERT哈哈哈。</p>
<p>准备期间也开了好几次会，做答辩排练，完善一下学姐的答辩过程。我们还准备了很多自问自答，想想自己如果是评委，会对我们的演讲提一些什么问题。</p>
<p>唯一比较遗憾的就是，我们三个人都没能在决赛现场见上面。师兄在实习不让请假，我因为看到广州有一天增加了12例直接吓怕了，不敢乱跑…所以就剩下学姐一人去杭州现场答辩啦，给我们直播会场情况。答辩过程蛮顺利的，评委问的其中一个问题还被我们押中了——“是不是融合越多模型越好？”直接搬出西瓜书的”偏差-方差窘境”，完美！另一个问题也蛮简单的，问预训练后有没有finetune，其实就是问有没有冻结权重嘛，简单。还有之前加了几位其他队伍的选手的微信，他们还夸我们的PPT做得好看~</p>
<h2 id="7-5-反思"><a href="#7-5-反思" class="headerlink" title="7.5 反思"></a>7.5 反思</h2><p>这是第一次参加大数据竞赛，真的是远超出自己的预期。最开始我起的队伍名字是：希望能完赛。从一开始抱着重在参与的心态，到后来看到自己一步步在往上爬，再与队友相识，一起冲进复赛、冲进前10、冲进决赛…感觉有些不真实，感觉自己运气很好，遇到的队友是对的，遇到的一起竞赛的选手是乐于分享的，模型选的是没错的，自己调的参数是准的…当然，也别太得意了，开心一下就可以了，还要学的东西实在很多很多。</p>
<p>想起主办方发给我的采访问题：”你们的队伍有指导老师吗？如果有的话，能否讲讲指导老师给了你们哪些启发？”一开始我写下的答案只有5个字：”无指导老师”。但是转头一想，每周的前两名周周星会进行方案分享，而我也会在比赛交流群里请教各位前辈，对作为新手的我来说，他们就是我的指导老师。</p>
<p>在知乎看到过非常扎心的一段话：”很多比赛的Leaderboard里大家的分数都相差不大，造成这种现象的原因是因为已经有好的baseline快接近数据上限了，因此大家的分数都挤在一个小区间里。如果去找一个没有现成baseline的机器视觉比赛看看，就会发现大家的差距其实大的可怕，1000人的比赛，可能第一名accuracy到0.95，第五十名还在0.6动弹不得。”</p>
<p>想想我，不就是这个情况吗？一开始我自己的代码真是一团糟，得亏其他选手开源了baseline，我才能有后续的一系列成绩。要走的路还长着呢！</p>
<p>继续努力。</p>

    </div>

    
    
    
    
    <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束，感谢阅读。-------------</div>

    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Competition/" rel="tag"><i class="fa fa-tag"></i> Competition</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/post/7b768b28.html" rel="prev" title="LeetCode第389题 & Java字符位运算">
      <i class="fa fa-chevron-left"></i> LeetCode第389题 & Java字符位运算
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#0-%E5%89%8D%E8%A8%80"><span class="nav-text">0 前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-%E8%B5%9B%E9%A2%98%E4%BB%8B%E7%BB%8D"><span class="nav-text">1 赛题介绍</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-%E6%95%B0%E6%8D%AE%E6%A0%B7%E4%BE%8B"><span class="nav-text">2 数据样例</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#3-%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2%E4%B8%8E%E5%88%86%E6%9E%90"><span class="nav-text">3 数据探索与分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-data%E5%88%86%E5%B8%83"><span class="nav-text">3.1 data分布</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-%E5%8F%A5%E9%95%BF%E5%88%86%E5%B8%83"><span class="nav-text">3.2 句长分布</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-%E8%AF%8D%E9%A2%91%E7%BB%9F%E8%AE%A1"><span class="nav-text">3.3 词频统计</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#4-%E6%A8%A1%E5%9E%8B"><span class="nav-text">4 模型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-%E5%88%9D%E8%B5%9B"><span class="nav-text">4.1 初赛</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-%E5%A4%8D%E8%B5%9B%E6%A8%A1%E5%9E%8B"><span class="nav-text">4.2 复赛模型</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#5-%E5%A4%B1%E8%B4%A5%E7%9A%84%E5%B0%9D%E8%AF%95"><span class="nav-text">5 失败的尝试</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#6-%E6%96%B9%E6%A1%88%E4%B8%8D%E8%B6%B3"><span class="nav-text">6 方案不足</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#7-%E4%B8%8E%E8%87%AA%E5%B7%B1%E6%9C%89%E5%85%B3%E7%9A%84%E4%BA%8B%E6%83%85"><span class="nav-text">7 与自己有关的事情</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-%E5%8F%82%E8%B5%9B%E5%89%8D"><span class="nav-text">7.1 参赛前</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-%E5%88%9D%E8%B5%9B"><span class="nav-text">7.2 初赛</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-1-%E5%B0%9D%E8%AF%95"><span class="nav-text">7.2.1 尝试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-2-%E7%BB%93%E8%AF%86%E6%96%B0%E9%98%9F%E5%8F%8B"><span class="nav-text">7.2.2 结识新队友</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-3-%E5%90%8E%E6%9C%9F"><span class="nav-text">7.2.3 后期</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-%E5%A4%8D%E8%B5%9B"><span class="nav-text">7.3 复赛</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-1-A%E6%A6%9C"><span class="nav-text">7.3.1 A榜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-2-B%E6%A6%9C"><span class="nav-text">7.3.2 B榜</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-4-%E5%86%B3%E8%B5%9B"><span class="nav-text">7.4 决赛</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-5-%E5%8F%8D%E6%80%9D"><span class="nav-text">7.5 反思</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Yihao Chan"
      src="/assets/avatar.jpg">
  <p class="site-author-name" itemprop="name">Yihao Chan</p>
  <div class="site-description" itemprop="description">God helps those who help themselves.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/YihaoChan" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;YihaoChan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:chenyihao19990707@163.com" title="E-Mail → mailto:chenyihao19990707@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/yihaochan" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;yihaochan" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yihao Chan</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">22k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">20 mins.</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>


        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
